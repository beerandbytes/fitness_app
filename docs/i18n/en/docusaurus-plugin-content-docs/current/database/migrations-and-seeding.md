---
id: migrations-and-seeding
title: Migrations and data seeding
---

The backend uses **Drizzle ORM** with SQL migrations to create and evolve the database schema.

## Migrations

- Folder: `fitness-app-backend/drizzle/`
  - Contains `.sql` files generated by `drizzle-kit`.
  - Each file represents a schema change (table creation, indexes, columns, etc.).

- Migration script:
  - Defined in `fitness-app-backend/package.json`:
    - `db:migrate`: runs `node ./db/migrate.js`.
  - `db/migrate.js`:
    - Connects to `DATABASE_URL`.
    - Calls `migrate(db, { migrationsFolder: "./drizzle" })`.
    - Handles common "already exists" errors as warnings.

### Local execution

```bash
cd fitness-app-backend
DATABASE_URL=postgresql://user:pass@localhost:5432/fitnessdb npm run db:migrate
```

### Production execution (Docker / Render)

- In Docker:
  - `docker-entrypoint.sh` automatically runs:
    - `npm run db:migrate` when container starts.

- In Render:
  - You can run `npm run db:migrate` from the backend service Shell.

## Exercise seeding

- Script: `scripts/seed-exercises.js`
  - Inserts a small set of example exercises (public).

- Script: `scripts/populate-free-exercise-db.js`
  - Downloads an exercises JSON from `free-exercise-db` (GitHub).
  - Inserts or updates hundreds of exercises in the `exercises` table.
  - Ensures:
    - `is_public = true`.
    - Required fields (`name`, `category`) are present.
    - Duplicates by name are avoided.

- Cleanup scripts:
  - `scripts/remove-exercises-without-images.js`, `clean-invalid-exercises-*.js`, etc.
  - Goal is to leave in `exercises` table only those with valid images or videos.

### Recommended flow for exercises

1. Run migrations.
2. Run:

```bash
cd fitness-app-backend
npm run populate:exercises
```

3. Verify:

```bash
node ./scripts/verify-exercises.js
```

## Food seeding

- Scripts:
  - `scripts/seed-common-foods.js`
  - `scripts/seed-extended-foods.js`
  - `scripts/seed-openfoodfacts.js`

These scripts insert records in the `foods` table with basic nutritional information.

## Test users

- Script: `scripts/create-test-user.js`
  - Creates a test user with associated routines, exercises and foods.
  - Useful for development and demo environments.

